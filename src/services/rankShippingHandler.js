// src/services/rankShippingHandler.js
const VALID_RANKS = ["silver rabbit", "diamond rabbit", "star rabbit"];

/**
 * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö Rank ‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á
 * @param {DialogflowAgent} agent - Dialogflow agent
 * @param {FirebaseDatabase} db - Firebase database instance
 */
async function handleRankShippingInquiry(agent, db) {
  const intent = agent.intent;

  // Log ‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  const userId =
    agent.originalRequest?.payload?.data?.source?.userId || "unknown";
  const inquiryRef = db.ref(`rank_shipping_inquiries/${userId}`);
  await inquiryRef.push({
    timestamp: new Date().toISOString(),
    intent: intent,
    query: agent.query,
  });

  switch (intent) {
    case "RankInquiry":
      return handleRankInquiry(agent, db);
    case "CarShippingRates":
      return handleCarShippingRates(agent, db);
    case "ShipShippingRates":
      return handleShipShippingRates(agent, db);
    default:
      return agent.add("‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏∞");
  }
}

/**
 * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö Rank ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
 * @param {DialogflowAgent} agent - Dialogflow agent
 * @param {FirebaseDatabase} db - Firebase database instance
 */
async function handleRankInquiry(agent, db) {
  const response = `üìå ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏°‡∏µ 3 ‡∏£‡∏∞‡∏î‡∏±‡∏ö Rank:

1Ô∏è‚É£ **Silver Rabbit** ü•à  
2Ô∏è‚É£ **Diamond Rabbit** üíé  
3Ô∏è‚É£ **Star Rabbit** ‚≠ê  

üîπ Rank ‡∏ó‡∏µ‡πà‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏á  
üîπ ‡∏™‡∏ô‡πÉ‡∏à‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ‡πÅ‡∏à‡πâ‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏∞ üòä`;

  agent.add(response);
}

/**
 * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏ó‡∏≤‡∏á‡∏£‡∏ñ
 * @param {DialogflowAgent} agent - Dialogflow agent
 * @param {FirebaseDatabase} db - Firebase database instance
 */
async function handleCarShippingRates(agent, db) {
  const response = `üöõ **‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏ó‡∏≤‡∏á‡∏£‡∏ñ (‡∏à‡∏≤‡∏Å‡∏à‡∏µ‡∏ô‡∏°‡∏≤‡πÑ‡∏ó‡∏¢) ‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö Rank**  

üîπ **Silver Rabbit**  
- ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ: **50 ‡∏ö‡∏≤‡∏ó/kg** ‡∏´‡∏£‡∏∑‡∏≠ **7,500 ‡∏ö‡∏≤‡∏ó/CBM**  
- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó 1,2: **60 ‡∏ö‡∏≤‡∏ó/kg** ‡∏´‡∏£‡∏∑‡∏≠ **8,500 ‡∏ö‡∏≤‡∏ó/CBM**  
- ‡∏û‡∏¥‡πÄ‡∏®‡∏©: **120 ‡∏ö‡∏≤‡∏ó/kg** ‡∏´‡∏£‡∏∑‡∏≠ **12,000 ‡∏ö‡∏≤‡∏ó/CBM**  

üîπ **Diamond Rabbit**  
- ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ: **45 ‡∏ö‡∏≤‡∏ó/kg** ‡∏´‡∏£‡∏∑‡∏≠ **7,300 ‡∏ö‡∏≤‡∏ó/CBM**  
- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó 1,2: **55 ‡∏ö‡∏≤‡∏ó/kg** ‡∏´‡∏£‡∏∑‡∏≠ **8,300 ‡∏ö‡∏≤‡∏ó/CBM**  
- ‡∏û‡∏¥‡πÄ‡∏®‡∏©: **110 ‡∏ö‡∏≤‡∏ó/kg** ‡∏´‡∏£‡∏∑‡∏≠ **11,000 ‡∏ö‡∏≤‡∏ó/CBM**  

üîπ **Star Rabbit**  
- ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ: **40 ‡∏ö‡∏≤‡∏ó/kg** ‡∏´‡∏£‡∏∑‡∏≠ **6,800 ‡∏ö‡∏≤‡∏ó/CBM**  
- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó 1,2: **50 ‡∏ö‡∏≤‡∏ó/kg** ‡∏´‡∏£‡∏∑‡∏≠ **7,800 ‡∏ö‡∏≤‡∏ó/CBM**  
- ‡∏û‡∏¥‡πÄ‡∏®‡∏©: **100 ‡∏ö‡∏≤‡∏ó/kg** ‡∏´‡∏£‡∏∑‡∏≠ **10,000 ‡∏ö‡∏≤‡∏ó/CBM**  

üìå *‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠ CBM ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÑ‡∏´‡∏ô‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤*  
üìå *‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏à‡∏£‡∏¥‡∏á ‡πÅ‡∏à‡πâ‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞* üòä`;

  agent.add(response);
}

/**
 * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏∑‡∏≠
 * @param {DialogflowAgent} agent - Dialogflow agent
 * @param {FirebaseDatabase} db - Firebase database instance
 */
async function handleShipShippingRates(agent, db) {
  const response = `üö¢ **‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏∑‡∏≠ (‡∏à‡∏≤‡∏Å‡∏à‡∏µ‡∏ô‡∏°‡∏≤‡πÑ‡∏ó‡∏¢) ‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö Rank**  

üîπ **Silver Rabbit**  
- ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ: **45 ‡∏ö‡∏≤‡∏ó/kg** ‡∏´‡∏£‡∏∑‡∏≠ **5,400 ‡∏ö‡∏≤‡∏ó/CBM**  
- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó 1,2: **50 ‡∏ö‡∏≤‡∏ó/kg** ‡∏´‡∏£‡∏∑‡∏≠ **6,900 ‡∏ö‡∏≤‡∏ó/CBM**  
- ‡∏û‡∏¥‡πÄ‡∏®‡∏©: **120 ‡∏ö‡∏≤‡∏ó/kg** ‡∏´‡∏£‡∏∑‡∏≠ **12,000 ‡∏ö‡∏≤‡∏ó/CBM**  

üîπ **Diamond Rabbit**  
- ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ: **40 ‡∏ö‡∏≤‡∏ó/kg** ‡∏´‡∏£‡∏∑‡∏≠ **4,900 ‡∏ö‡∏≤‡∏ó/CBM**  
- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó 1,2: **50 ‡∏ö‡∏≤‡∏ó/kg** ‡∏´‡∏£‡∏∑‡∏≠ **6,500 ‡∏ö‡∏≤‡∏ó/CBM**  
- ‡∏û‡∏¥‡πÄ‡∏®‡∏©: **110 ‡∏ö‡∏≤‡∏ó/kg** ‡∏´‡∏£‡∏∑‡∏≠ **11,000 ‡∏ö‡∏≤‡∏ó/CBM**  

üîπ **Star Rabbit**  
- ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ: **35 ‡∏ö‡∏≤‡∏ó/kg** ‡∏´‡∏£‡∏∑‡∏≠ **4,500 ‡∏ö‡∏≤‡∏ó/CBM**  
- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó 1,2: **45 ‡∏ö‡∏≤‡∏ó/kg** ‡∏´‡∏£‡∏∑‡∏≠ **6,300 ‡∏ö‡∏≤‡∏ó/CBM**  
- ‡∏û‡∏¥‡πÄ‡∏®‡∏©: **100 ‡∏ö‡∏≤‡∏ó/kg** ‡∏´‡∏£‡∏∑‡∏≠ **10,000 ‡∏ö‡∏≤‡∏ó/CBM**  

üìå *‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏à‡∏£‡∏¥‡∏á‡∏´‡∏£‡∏∑‡∏≠ CBM ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÑ‡∏´‡∏ô‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤*  
üìå *‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏Ç‡∏ô‡∏™‡πà‡∏á‡∏à‡∏£‡∏¥‡∏á ‡πÅ‡∏à‡πâ‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞* üòä`;

  agent.add(response);
}

module.exports = {
  handleRankShippingInquiry,
  handleRankInquiry,
  handleCarShippingRates,
  handleShipShippingRates,
};
